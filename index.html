<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logic.AI - Reasoning Puzzle Master</title>
    
    <!-- 1. Tailwind CSS (Styling) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. React & ReactDOM (Core Engine) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    
    <!-- 3. Babel (Translator for Browser) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Custom Scrollbar Hide for Clean UI */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
        }
    </style>
</head>
<body class="bg-[#050505] text-white">
    <div id="root"></div>

    <script type="text/babel">
        // --- DEPS & ICONS (Internal Definitions to fix ReferenceError) ---
        const { useState, useEffect, useRef } = React;

        // Generic Icon Component
        const Icon = ({ children, size = 24, className = "", ...props }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className} 
                {...props}
            >
                {children}
            </svg>
        );

        // Specific Icons
        const Timer = (props) => <Icon {...props}><line x1="10" x2="14" y1="2" y2="2"/><line x1="12" x2="15" y1="14" y2="11"/><circle cx="12" cy="14" r="8"/></Icon>;
        const CheckCircle = (props) => <Icon {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></Icon>;
        const AlertCircle = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></Icon>;
        const RefreshCcw = (props) => <Icon {...props}><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 16h5v5"/></Icon>;
        const HelpCircle = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></Icon>;
        const Trophy = (props) => <Icon {...props}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></Icon>;
        const Camera = (props) => <Icon {...props}><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></Icon>;
        const Loader2 = (props) => <Icon {...props}><path d="M21 12a9 9 0 1 1-6.219-8.56"/></Icon>;
        const Play = (props) => <Icon {...props}><polygon points="5 3 19 12 5 21 5 3"/></Icon>;
        const FileText = (props) => <Icon {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></Icon>;
        const ClipboardList = (props) => <Icon {...props}><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M12 11h4"/><path d="M12 16h4"/><path d="M8 11h.01"/><path d="M8 16h.01"/></Icon>;
        const ChevronLeft = (props) => <Icon {...props}><polyline points="15 18 9 12 15 6"/></Icon>;
        const Sparkles = (props) => <Icon {...props}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 5h4"/><path d="M3 9h4"/></Icon>;
        const BookOpen = (props) => <Icon {...props}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></Icon>;
        const Database = (props) => <Icon {...props}><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></Icon>;
        const Trash2 = (props) => <Icon {...props}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></Icon>;


        // --- MAIN APP COMPONENT ---
        const App = () => {
            // --- STATE MANAGEMENT ---
            const [gameState, setGameState] = useState('menu'); 
            const [timeLeft, setTimeLeft] = useState(0);
            const [activeCell, setActiveCell] = useState(null);
            const [isAiLoading, setIsAiLoading] = useState(false);
            const [customText, setCustomText] = useState('');
            const [activeCase, setActiveCase] = useState(1); 
            
            // Library State
            const [library, setLibrary] = useState([]);
            
            const fileInputRef = useRef(null);
            const [levelData, setLevelData] = useState(null);
            const [userAnswers, setUserAnswers] = useState({ case1: {}, case2: {} });
            const [aiExplanation, setAiExplanation] = useState('');

            // IMPORTANT: API Key here
            const apiKey = ""; 

            // --- LOCAL STORAGE ---
            useEffect(() => {
                const savedLibrary = localStorage.getItem('puzzleVault');
                if (savedLibrary) {
                    setLibrary(JSON.parse(savedLibrary));
                }
            }, []);

            // --- SAVE TO LIBRARY ---
            const saveToLibrary = (data) => {
                const newLevelNumber = library.length + 1;
                const newEntry = {
                    id: Date.now(), 
                    levelNumber: newLevelNumber,
                    title: data.title || `Puzzle #${newLevelNumber}`,
                    data: data,
                    date: new Date().toLocaleDateString()
                };
                
                const updatedLibrary = [...library, newEntry];
                setLibrary(updatedLibrary);
                localStorage.setItem('puzzleVault', JSON.stringify(updatedLibrary));
                return newEntry.id;
            };

            // --- DELETE LEVEL ---
            const deleteLevel = (id, e) => {
                e.stopPropagation();
                if (window.confirm("Delete this puzzle?")) {
                    const updatedLibrary = library.filter(item => item.id !== id);
                    const reindexed = updatedLibrary.map((item, index) => ({
                        ...item,
                        levelNumber: index + 1
                    }));
                    setLibrary(reindexed);
                    localStorage.setItem('puzzleVault', JSON.stringify(reindexed));
                }
            };

            // --- API CALL ---
            const callGeminiAPI = async (payload, retries = 5, delay = 1000) => {
                // Check for API Key
                if (!apiKey) {
                    alert("API Key missing! Please open index.html and add your Gemini API Key in the code.");
                    throw new Error("API Key Missing");
                }

                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) throw new Error('API request failed');
                    return await response.json();
                } catch (error) {
                    if (retries > 0) {
                        await new Promise(res => setTimeout(res, delay));
                        return callGeminiAPI(payload, retries - 1, delay * 2);
                    }
                    throw error;
                }
            };

            // --- PROCESS AI ---
            const processWithAI = async (content, isImage = false) => {
                setIsAiLoading(true);
                setGameState('scanning');

                const prompt = `Analyze this reasoning puzzle ${isImage ? 'image' : 'text'}. 
                Identify names, attributes (fields), options, and hints.
                Return strictly JSON format:
                {
                "title": "Short Descriptive Title",
                "names": ["Name1", "Name2"...],
                "fields": ["Field1", "Field2"...],
                "options": { "Field1": ["Opt1", "Opt2"...], "Field2": [...] },
                "hints": ["Hint 1", "Hint 2"...],
                "solution": { "Name1": {"Field1": "Val", "Field2": "Val"}, ... },
                "explanation": "Provide a step-by-step logic guide in Hinglish. Act like a competitive exam mentor. Mention 'Shortcut' tips."
                }
                Important: Ensure names and options arrays match in size. If it's a floor puzzle, add 'Floor' as a field.`;

                try {
                    const payload = {
                        contents: [{
                            parts: [
                                { text: prompt },
                                isImage 
                                ? { inlineData: { mimeType: "image/png", data: content.split(',')[1] } }
                                : { text: `Puzzle Text: ${content}` }
                            ]
                        }]
                    };

                    const result = await callGeminiAPI(payload);
                    const textResponse = result.candidates?.[0]?.content?.parts?.[0]?.text;
                    const jsonMatch = textResponse.match(/\{[\s\S]*\}/);
                    if (!jsonMatch) throw new Error("Could not parse AI response");
                    
                    const parsedData = JSON.parse(jsonMatch[0]);
                    const savedId = saveToLibrary(parsedData);
                    
                    setAiExplanation(parsedData.explanation);
                    setupGame(parsedData, savedId);
                } catch (error) {
                    console.error(error);
                    if(error.message !== "API Key Missing") {
                        alert("AI Error: Text clear nahi hai ya API limit over hai.");
                    }
                    setGameState('menu');
                } finally {
                    setIsAiLoading(false);
                }
            };

            // --- SETUP GAME ---
            const setupGame = (data, levelId = null) => {
                const emptyAnswers = {};
                data.names.forEach(name => {
                    emptyAnswers[name] = {};
                    data.fields.forEach(field => {
                        emptyAnswers[name][field] = '';
                    });
                });
                
                setUserAnswers({ 
                    case1: JSON.parse(JSON.stringify(emptyAnswers)), 
                    case2: JSON.parse(JSON.stringify(emptyAnswers)) 
                });
                
                setLevelData(data);
                setAiExplanation(data.explanation);
                
                setTimeLeft(data.names.length * 90); 
                setGameState('playing');
            };

            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => processWithAI(reader.result, true);
                    reader.readAsDataURL(file);
                }
            };

            useEffect(() => {
                if (gameState !== 'playing' || timeLeft <= 0) return;
                const timer = setInterval(() => setTimeLeft(prev => (prev <= 1 ? 0 : prev - 1)), 1000);
                return () => clearInterval(timer);
            }, [gameState, timeLeft]);

            useEffect(() => {
                if (timeLeft === 0 && gameState === 'playing') setGameState('lost');
            }, [timeLeft, gameState]);

            const handleSelect = (value) => {
                if (!activeCell) return;
                const { name, field } = activeCell;
                const currentCaseKey = activeCase === 1 ? 'case1' : 'case2';
                setUserAnswers(prev => ({
                    ...prev,
                    [currentCaseKey]: {
                        ...prev[currentCaseKey],
                        [name]: { ...prev[currentCaseKey][name], [field]: value }
                    }
                }));
                setActiveCell(null);
            };

            const checkSolution = () => {
                const currentAnswers = activeCase === 1 ? userAnswers.case1 : userAnswers.case2;
                let isCorrect = true;
                levelData.names.forEach(name => {
                    levelData.fields.forEach(field => {
                        if (currentAnswers[name][field] !== levelData.solution[name][field]) isCorrect = false;
                    });
                });

                if (isCorrect) setGameState('won');
                else alert("Logic match nahi hua. Hints check karein.");
            };

            const currentCaseData = activeCase === 1 ? userAnswers.case1 : userAnswers.case2;

            // --- UI SCREENS ---
            if (gameState === 'menu') {
                return (
                    <div className="min-h-screen p-6 flex flex-col items-center justify-center font-sans">
                        <div className="fixed -top-20 -left-20 w-64 h-64 bg-blue-600/20 rounded-full blur-[100px]"></div>
                        <div className="relative z-10 w-full max-w-sm flex flex-col items-center">
                            <div className="w-24 h-24 bg-gradient-to-tr from-blue-600 to-indigo-500 rounded-[2.5rem] flex items-center justify-center mb-6 shadow-2xl border-4 border-white/5 animate-pulse">
                                <Sparkles size={40} className="text-white" />
                            </div>
                            <h1 className="text-5xl font-black mb-2 tracking-tighter italic text-transparent bg-clip-text bg-gradient-to-br from-white to-slate-400">LOGIC.AI</h1>
                            <p className="text-slate-500 text-sm mb-10 font-bold uppercase tracking-widest text-center">Exam Prep Terminal</p>
                            
                            <div className="w-full space-y-4">
                                <button onClick={() => setGameState('input_text')} className="w-full bg-white text-black p-6 rounded-[2rem] font-black flex items-center gap-4 active:scale-95 transition-all shadow-xl group">
                                    <div className="p-2 bg-slate-100 rounded-full group-hover:bg-slate-200"><FileText size={20} /></div>
                                    <span className="text-lg">Paste Question</span>
                                </button>
                                <button onClick={() => fileInputRef.current.click()} className="w-full bg-slate-900 border border-white/10 p-6 rounded-[2rem] font-black flex items-center gap-4 active:scale-95 transition-all group">
                                    <div className="p-2 bg-slate-800 rounded-full group-hover:bg-slate-700"><Camera size={20} className="text-blue-500" /></div>
                                    <span className="text-lg">Scan from Book</span>
                                </button>
                                <button onClick={() => setGameState('library')} className="w-full bg-slate-900 border border-white/10 p-6 rounded-[2rem] font-black flex items-center gap-4 active:scale-95 transition-all group">
                                    <div className="p-2 bg-slate-800 rounded-full group-hover:bg-slate-700"><Database size={20} className="text-green-500" /></div>
                                    <div className="flex flex-col text-left">
                                        <span className="text-lg">Memory Vault</span>
                                        <span className="text-[10px] text-slate-500 uppercase tracking-widest font-bold">Total: {library.length}</span>
                                    </div>
                                </button>
                                <input type="file" ref={fileInputRef} onChange={handleFileUpload} accept="image/*" className="hidden" />
                            </div>
                        </div>
                    </div>
                );
            }

            if (gameState === 'library') {
                return (
                    <div className="min-h-screen p-6 flex flex-col items-center">
                        <div className="w-full max-w-md pt-6 flex flex-col h-full">
                            <button onClick={() => setGameState('menu')} className="mb-6 text-blue-500 font-black uppercase text-xs flex items-center gap-1 self-start">
                                <ChevronLeft size={16} /> Main Menu
                            </button>
                            <div className="flex justify-between items-end mb-6">
                                <h2 className="text-4xl font-black italic tracking-tighter">Vault</h2>
                                <span className="text-sm font-bold text-slate-500 bg-white/5 px-3 py-1 rounded-full border border-white/5">{library.length} Puzzles</span>
                            </div>
                            
                            {library.length === 0 ? (
                                <div className="flex flex-col items-center justify-center flex-1 text-center opacity-50 mt-20">
                                    <Database size={64} className="mb-4 text-slate-600" />
                                    <p className="text-lg font-bold">No Puzzles Saved</p>
                                </div>
                            ) : (
                                <div className="space-y-3 overflow-y-auto pb-20 custom-scrollbar">
                                    {library.slice().reverse().map((level) => (
                                        <div key={level.id} onClick={() => setupGame(level.data, level.id)} className="bg-white/5 border border-white/10 p-5 rounded-[2rem] active:scale-95 transition-all cursor-pointer hover:bg-white/10 group relative">
                                            <div className="flex justify-between items-start">
                                                <div>
                                                    <span className="text-[10px] font-black text-blue-500 uppercase tracking-widest block mb-1">Level {level.levelNumber}</span>
                                                    <h3 className="text-lg font-bold leading-tight line-clamp-1">{level.title}</h3>
                                                    <p className="text-xs text-slate-500 mt-2 font-mono">{level.date}</p>
                                                </div>
                                                <button onClick={(e) => deleteLevel(level.id, e)} className="p-3 bg-slate-900 rounded-full text-slate-600 hover:text-red-500 transition-colors z-10"><Trash2 size={16} /></button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            if (gameState === 'input_text') {
                return (
                    <div className="min-h-screen p-6 flex flex-col items-center">
                        <div className="w-full max-w-md pt-6">
                            <button onClick={() => setGameState('menu')} className="mb-8 text-blue-500 font-black uppercase text-xs flex items-center gap-1">
                                <ChevronLeft size={16} /> Back
                            </button>
                            <h2 className="text-4xl font-black mb-6 italic tracking-tighter">Input Data</h2>
                            <textarea 
                                className="w-full h-80 bg-white/5 border border-white/10 rounded-[2.5rem] p-8 text-slate-200 focus:outline-none focus:border-blue-500 transition-all resize-none font-medium placeholder:text-slate-700"
                                placeholder="Paste your puzzle text here..."
                                value={customText}
                                onChange={(e) => setCustomText(e.target.value)}
                            />
                            <button disabled={!customText.trim()} onClick={() => processWithAI(customText)} className="w-full mt-8 bg-blue-600 disabled:opacity-50 p-6 rounded-[2rem] font-black text-xl shadow-2xl active:scale-95 transition-all">GENERATE & SAVE</button>
                        </div>
                    </div>
                );
            }

            if (gameState === 'scanning') {
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center text-center p-10">
                        <Loader2 size={64} className="text-blue-500 animate-spin mb-8" />
                        <h2 className="text-3xl font-black italic tracking-tighter">AI ANALYZING</h2>
                        <p className="text-slate-500 mt-2 font-bold uppercase text-[10px] tracking-widest">Saving to Vault...</p>
                    </div>
                );
            }

            return (
                <div className="min-h-screen p-4 flex flex-col items-center pb-40 overflow-x-hidden">
                    <div className="w-full max-w-md bg-white/5 backdrop-blur-xl p-5 rounded-[2.5rem] border border-white/10 mb-6 flex justify-between items-center shadow-2xl">
                        <div className="flex flex-col overflow-hidden max-w-[60%]">
                            <div className="flex items-center gap-2">
                                <span className="text-[10px] font-black bg-white/10 px-2 py-0.5 rounded text-slate-400">LVL {library.find(l => l.data === levelData)?.levelNumber || '?'}</span>
                                <h2 className="text-xs font-black text-blue-400 uppercase tracking-widest truncate">{levelData?.title || 'Practice'}</h2>
                            </div>
                            <div className="flex gap-2 mt-2">
                                <button onClick={() => setActiveCase(1)} className={`px-4 py-1.5 rounded-full text-[10px] font-black transition-all ${activeCase === 1 ? 'bg-blue-600 text-white shadow-lg' : 'bg-white/5 text-slate-500'}`}>CASE 1</button>
                                <button onClick={() => setActiveCase(2)} className={`px-4 py-1.5 rounded-full text-[10px] font-black transition-all ${activeCase === 2 ? 'bg-blue-600 text-white shadow-lg' : 'bg-white/5 text-slate-500'}`}>CASE 2</button>
                            </div>
                        </div>
                        <div className={`text-2xl font-mono font-black ${timeLeft < 60 ? 'text-red-500 animate-pulse' : 'text-blue-400'}`}>
                            {Math.floor(timeLeft / 60)}:{(timeLeft % 60).toString().padStart(2, '0')}
                        </div>
                    </div>

                    <div className="w-full max-w-md bg-white/[0.02] border border-white/10 rounded-[2.5rem] p-6 mb-6">
                        <div className="flex items-center justify-between mb-4">
                            <span className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Logic Clues</span>
                            <BookOpen size={16} className="text-blue-500 opacity-50" />
                        </div>
                        <div className="space-y-4 max-h-40 overflow-y-auto pr-2 custom-scrollbar">
                            {levelData?.hints.map((h, i) => (
                                <p key={i} className="text-sm text-slate-300 font-medium leading-relaxed border-l-2 border-blue-500/30 pl-3">{h}</p>
                            ))}
                        </div>
                    </div>

                    <div className="w-full max-w-md bg-white/[0.01] rounded-[2.5rem] border border-white/10 overflow-hidden mb-8 shadow-2xl">
                        <div className="overflow-x-auto scrollbar-hide">
                            <table className="w-full border-collapse">
                                <thead>
                                    <tr className="bg-white/5">
                                        <th className="p-5 text-[10px] font-black text-slate-500 uppercase text-left sticky left-0 bg-[#050505] z-10 border-r border-white/5">Name</th>
                                        {levelData?.fields.map(f => <th key={f} className="p-5 text-[10px] font-black text-slate-500 uppercase text-center min-w-[140px]">{f}</th>)}
                                    </tr>
                                </thead>
                                <tbody>
                                    {levelData?.names.map(name => (
                                        <tr key={name} className="border-b border-white/5 last:border-0 hover:bg-white/[0.01]">
                                            <td className="p-5 font-black text-white bg-[#050505] sticky left-0 text-sm border-r border-white/5">{name}</td>
                                            {levelData?.fields.map(field => (
                                                <td key={field} onClick={() => setActiveCell({ name, field })} className="p-3">
                                                    <div className={`h-14 rounded-2xl flex items-center justify-center text-[10px] font-black uppercase border transition-all ${currentCaseData[name]?.[field] ? 'bg-blue-600/10 border-blue-500/40 text-blue-400' : 'bg-white/5 border-transparent text-slate-800'}`}>
                                                        {currentCaseData[name]?.[field] || 'Tap'}
                                                    </div>
                                                </td>
                                            ))}
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div className="fixed bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-black via-black/95 to-transparent z-[50]">
                        <div className="max-w-md mx-auto grid grid-cols-4 gap-4">
                            <button onClick={() => setGameState('menu')} className="bg-slate-900 h-16 rounded-[1.5rem] flex items-center justify-center border border-white/5 active:scale-90 transition-all">
                                <RefreshCcw size={24} className="text-slate-500" />
                            </button>
                            <button onClick={checkSolution} className="col-span-3 bg-white text-black h-16 rounded-[1.5rem] flex items-center justify-center gap-3 font-black text-lg active:scale-95 transition-all shadow-xl">
                                <CheckCircle size={24} /> CHECK
                            </button>
                        </div>
                    </div>

                    {activeCell && (
                        <div className="fixed inset-0 bg-black/95 z-[100] flex items-end justify-center p-4">
                            <div className="bg-[#0f0f0f] w-full max-w-md rounded-[3rem] p-8 border border-white/10 animate-in slide-in-from-bottom duration-500">
                                <div className="w-12 h-1 bg-white/10 rounded-full mx-auto mb-8"></div>
                                <h3 className="text-3xl font-black mb-1 text-white">{activeCell.name}</h3>
                                <p className="text-[10px] text-blue-500 font-black uppercase tracking-widest mb-8">Set {activeCell.field}</p>
                                <div className="grid grid-cols-2 gap-4 max-h-[40vh] overflow-y-auto pr-2 custom-scrollbar">
                                    {levelData?.options[activeCell.field].map(opt => (
                                        <button key={opt} onClick={() => handleSelect(opt)} className={`p-6 rounded-2xl text-[11px] font-black border-2 transition-all flex items-center justify-center text-center ${currentCaseData[activeCell.name][activeCell.field] === opt ? 'bg-white border-white text-black' : 'bg-slate-900 border-white/5 text-slate-500'}`}>
                                            {opt}
                                        </button>
                                    ))}
                                </div>
                                <button onClick={() => setActiveCell(null)} className="w-full mt-6 py-4 text-slate-600 font-black uppercase text-[10px] tracking-widest">Close</button>
                            </div>
                        </div>
                    )}

                    {(gameState === 'won' || gameState === 'lost') && (
                        <div className="fixed inset-0 bg-[#050505] z-[200] flex flex-col items-center justify-center p-10 text-center animate-in zoom-in duration-300">
                            {gameState === 'won' ? (
                                <>
                                    <Trophy size={80} className="text-white mb-6 animate-bounce" />
                                    <h2 className="text-6xl font-black italic mb-4">SOLVED!</h2>
                                </>
                            ) : (
                                <>
                                    <AlertCircle size={80} className="text-red-500 mb-6" />
                                    <h2 className="text-6xl font-black text-red-500 italic mb-4">TIMEOUT!</h2>
                                </>
                            )}
                            <div className="w-full max-w-xs space-y-4">
                                <button onClick={() => setGameState('explanation')} className="w-full bg-white/10 border border-white/10 p-5 rounded-[2rem] text-white font-black flex items-center justify-center gap-2">
                                    <BookOpen size={20} /> VIEW MENTOR GUIDE
                                </button>
                                <button onClick={() => setGameState('menu')} className="w-full bg-blue-600 p-5 rounded-[2rem] text-white font-black text-xl shadow-xl shadow-blue-500/20">MAIN MENU</button>
                            </div>
                        </div>
                    )}

                    {gameState === 'explanation' && (
                        <div className="fixed inset-0 bg-[#050505] z-[300] p-8 flex flex-col text-white">
                            <button onClick={() => setGameState('menu')} className="mb-8 text-blue-500 font-black uppercase text-xs flex items-center gap-1">
                                <ChevronLeft size={16} /> Exit
                            </button>
                            <h2 className="text-4xl font-black italic mb-2">Mentor Guide</h2>
                            <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-6">Shortcut Analysis</p>
                            <div className="bg-white/5 p-8 rounded-[2.5rem] border border-white/10 text-slate-300 leading-relaxed font-medium whitespace-pre-wrap overflow-y-auto max-h-[60vh] custom-scrollbar shadow-inner text-sm italic">
                                {aiExplanation || "Explanation loading..."}
                            </div>
                            <button onClick={() => setGameState('menu')} className="mt-8 bg-blue-600 p-6 rounded-[2rem] font-black text-xl shadow-xl">BACK TO MENU</button>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
